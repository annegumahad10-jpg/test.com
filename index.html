<!DOCTYPE html>
<html>
<head>
  <title>Mini SHEIN Social</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin:0; background: #f0f2f5; }
    .header { background: linear-gradient(90deg,#8e44ad,#ff4d6d); color:white; padding:15px 20px; text-align:center; font-size:24px; font-weight:bold; box-shadow:0 3px 8px rgba(0,0,0,0.2);}
    .card { background:white; padding:20px; margin:20px auto; border-radius:15px; max-width:500px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
    input, textarea { width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1px solid #ddd; font-size:16px;}
    .btn { padding:10px 18px; border-radius:10px; border:none; cursor:pointer; font-weight:bold; margin-top:10px; transition:0.3s; font-size:16px; }
    .btn-red { background:#ff4d6d;color:white;} .btn-red:hover{background:#e63950;}
    .btn-purple { background:#8e44ad;color:white;} .btn-purple:hover{background:#732d91;}
    .btn-white { background:white;color:#8e44ad;border:2px solid #8e44ad;} .btn-white:hover{background:#f2e6ff;}
    .post { background:#f9f9f9; padding:12px; margin-top:12px; border-radius:12px; text-align:left; position:relative;}
    .username { font-weight:bold; color:#8e44ad; margin-right:6px; }
    .post img { max-width:100%; margin-top:8px; border-radius:8px; }
    .post-buttons { display:flex; justify-content:flex-end; margin-top:5px; }
    .post-buttons button { padding:5px 10px; margin-left:5px; font-size:14px;}
    #app { padding-top:50px; }
    label { font-weight:bold; margin-top:10px; display:block; }
  </style>
</head>
<body>

<div class="header">Mini SHEIN Social</div>
<div id="app"></div>

<script>
let currentUser = localStorage.getItem("currentUser") || "";
let posts = JSON.parse(localStorage.getItem("posts") || "[]");

// ---------- LOGIN ----------
function showLogin(){
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Login</h2>
      <input type="text" id="username" placeholder="Enter username" required>
      <button class="btn btn-red" onclick="login()">Login</button>
    </div>
  `;
}

function login(){
  const input = document.getElementById("username").value.trim();
  if(!input) return alert("Enter username");
  currentUser = input;
  localStorage.setItem("currentUser", currentUser);
  showHome();
}

// ---------- HOME / FEED ----------
function showHome(){
  let postsHTML = posts.map((p,index) => `
    <div class="post">
      <span class="username">${p.user}</span>${p.message || ""}
      ${p.image ? `<img src="${p.image}">` : ""}
      ${p.sheinLink ? `<p>ðŸ›’ SHEIN: <a href="${p.sheinLink}" target="_blank">${p.sheinLink}</a></p>` : ""}
      ${p.originalPrice ? `<p>Original Price: â‚±${p.originalPrice}</p>` : ""}
      ${p.discountedPrice ? `<p>70% Voucher Price: â‚±${p.discountedPrice}</p>` : ""}
      ${p.pointsUsed ? `<p>Points Used: ${p.pointsUsed}</p>` : ""}
      ${p.finalPrice ? `<p>Final Price: â‚±${p.finalPrice}</p>` : ""}
      ${p.user === currentUser ? `<div class="post-buttons">
        <button class="btn btn-white" onclick="unsendPost(${index})">Unsend</button>
      </div>` : ""}
    </div>
  `).join("");

  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Welcome, ${currentUser}</h2>

      <textarea id="message" placeholder="Write something..."></textarea>
      <input type="file" id="fileInput">

      <label>SHEIN Item Link / SKU (optional)</label>
      <input type="text" id="sheinLink" placeholder="Enter link or SKU">
      <label>Original Price (â‚±)</label>
      <input type="number" id="originalPrice" placeholder="Enter price...">
      <label>Points Available</label>
      <input type="number" id="points" placeholder="Enter points...">
      <button class="btn btn-purple" onclick="addPost()">Post</button>

      <div style="margin-top:20px;"><strong>Feed:</strong></div>
      <div id="feed">${postsHTML || "<p>No posts yet.</p>"}</div>
      <button class="btn btn-white" onclick="logout()">Logout</button>
    </div>
  `;
}

// ---------- ADD POST ----------
function addPost(){
  const msg = document.getElementById("message").value.trim();
  const fileInput = document.getElementById("fileInput");
  const sheinLink = document.getElementById("sheinLink").value.trim();
  const originalPrice = parseFloat(document.getElementById("originalPrice").value);
  const points = parseFloat(document.getElementById("points").value);

  if(!msg && !fileInput.files.length && !sheinLink) return alert("Enter message, file, or SHEIN link");

  // Calculate 70% capped 410
  let discountedPrice="", finalPrice="", pointsUsed="";
  if(originalPrice){
    const discount = Math.min(originalPrice*0.7,410);
    discountedPrice = Math.round(originalPrice - discount);
    if(points){
      const maxDeduction = Math.floor(discountedPrice*0.3);
      pointsUsed = Math.min(points, maxDeduction);
      finalPrice = discountedPrice - pointsUsed;
    }
  }

  let imageData="";
  let fileName="";
  if(fileInput.files.length){
    const file=fileInput.files[0];
    fileName=file.name;
    const reader=new FileReader();
    reader.onload=function(e){
      imageData=file.type.startsWith("image")?e.target.result:"";
      const newPost={user:currentUser,message:msg,image:imageData,sheinLink:sheinLink,originalPrice:originalPrice,discountedPrice:discountedPrice,pointsUsed:pointsUsed,finalPrice:finalPrice,file:!imageData?true:false,fileName:!imageData?fileName:""};
      posts.unshift(newPost);
      localStorage.setItem("posts",JSON.stringify(posts));
      showHome();
    }
    reader.readAsDataURL(file);
  } else {
    const newPost={user:currentUser,message:msg,image:"",sheinLink:sheinLink,originalPrice:originalPrice,discountedPrice:discountedPrice,pointsUsed:pointsUsed,finalPrice:finalPrice,file:false,fileName:""};
    posts.unshift(newPost);
    localStorage.setItem("posts",JSON.stringify(posts));
    showHome();
  }
}

// ---------- UNSEND ----------
function unsendPost(index){
  if(confirm("Are you sure you want to unsend this post?")){
    posts.splice(index,1);
    localStorage.setItem("posts",JSON.stringify(posts));
    showHome();
  }
}

// ---------- LOGOUT ----------
function logout(){
  currentUser="";
  localStorage.removeItem("currentUser");
  showLogin();
}

// ---------- INIT ----------
currentUser ? showHome() : showLogin();
</script>

</body>
</html>
